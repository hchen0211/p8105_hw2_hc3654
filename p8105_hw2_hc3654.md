p8105_hw1_hc3654
================
Haohua Chen
2025-09-25

``` r
library(tidyverse)
```

    ## ── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
    ## ✔ dplyr     1.1.4     ✔ readr     2.1.5
    ## ✔ forcats   1.0.0     ✔ stringr   1.5.1
    ## ✔ ggplot2   3.5.2     ✔ tibble    3.3.0
    ## ✔ lubridate 1.9.4     ✔ tidyr     1.3.1
    ## ✔ purrr     1.1.0     
    ## ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
    ## ✖ dplyr::filter() masks stats::filter()
    ## ✖ dplyr::lag()    masks stats::lag()
    ## ℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors

``` r
library(readxl)
library(haven)
```

# Problem 1

## pols-month dataset

``` r
pols_month_df <- 
  read_csv("fivethirtyeight_datasets/pols-month.csv", na = c("NA", ".", " ")) |> 
  janitor::clean_names() |> 
  separate(mon , into = c("year", "month", "day"), sep = "-"
  ) |> 
  mutate(month = month.name[as.numeric(month)]) |> 
  mutate(president = case_when(
    prez_dem == 1 ~ "dem",
    prez_gop == 1 ~ "gop"
  )) |> 
  select(-prez_dem, -prez_gop, -day)
```

    ## Rows: 822 Columns: 9
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (8): prez_gop, gov_gop, sen_gop, rep_gop, prez_dem, gov_dem, sen_dem, r...
    ## date (1): mon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

## snp dataset

``` r
snp_df <- 
  read_csv("fivethirtyeight_datasets/cpi.csv") |> 
  janitor::clean_names() |> 
  separate(date, into = c("year", "month", "day"), sep = "-") |> 
  mutate(month = month.name[as.numeric(month)]) |> 
  rename(snp_value = value) |> 
  arrange(year,month)
```

    ## Rows: 822 Columns: 2
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl  (1): VALUE
    ## date (1): DATE
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

## unemployment dataset

``` r
unemp_df <- 
  read_csv("fivethirtyeight_datasets/unemployment.csv") |> 
  janitor::clean_names() |> 
  pivot_longer(
    cols = jan:dec,
    names_to = "month",
    values_to = "unemployment"
  ) |> 
  mutate(
    month = month.name[match(tolower(month), tolower(month.abb))]) |> 
  mutate(year = as.character(year))
```

    ## Rows: 68 Columns: 13
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## dbl (13): Year, Jan, Feb, Mar, Apr, May, Jun, Jul, Aug, Sep, Oct, Nov, Dec
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

## Merge

``` r
pols_snp_unemp <- 
  inner_join(pols_month_df,snp_df, by = c("year","month")) |> 
  inner_join(unemp_df, by = c("year", "month"))

knitr::kable(head(pols_snp_unemp,10), caption  = "First 10 rows")
```

| year | month | gov_gop | sen_gop | rep_gop | gov_dem | sen_dem | rep_dem | president | day | snp_value | unemployment |
|:---|:---|---:|---:|---:|---:|---:|---:|:---|:---|---:|---:|
| 1948 | January | 22 | 53 | 253 | 24 | 48 | 198 | dem | 01 | 23.68 | 3.4 |
| 1948 | February | 22 | 53 | 253 | 24 | 48 | 198 | dem | 01 | 23.67 | 3.8 |
| 1948 | March | 22 | 53 | 253 | 24 | 48 | 198 | dem | 01 | 23.50 | 4.0 |
| 1948 | April | 22 | 53 | 253 | 24 | 48 | 198 | dem | 01 | 23.82 | 3.9 |
| 1948 | May | 22 | 53 | 253 | 24 | 48 | 198 | dem | 01 | 24.01 | 3.5 |
| 1948 | June | 22 | 53 | 253 | 24 | 48 | 198 | dem | 01 | 24.15 | 3.6 |
| 1948 | July | 22 | 53 | 253 | 24 | 48 | 198 | dem | 01 | 24.40 | 3.6 |
| 1948 | August | 22 | 53 | 253 | 24 | 48 | 198 | dem | 01 | 24.43 | 3.9 |
| 1948 | September | 22 | 53 | 253 | 24 | 48 | 198 | dem | 01 | 24.36 | 3.8 |
| 1948 | October | 22 | 53 | 253 | 24 | 48 | 198 | dem | 01 | 24.31 | 3.7 |

First 10 rows

## Writing question for problem 1:

The pols-month.csv dataset contains 822 observations and 9 variables. It
tracks the counts of Republican and Democratic governors, senators, and
representatives (gov_gop, sen_gop, rep_gop, gov_dem, sen_dem, rep_dem).
It also shows which party the sitting president belongs to, with year
and month as key time variables.

The snp.csv dataset contains 822 observations and 4 variables. It
represents the monthly S&P stock market index values (snp_value), along
with date variables (year, month, day).

The unemployment.csv dataset contains 816 observations and 3 variables,
recording the U.S. monthly unemployment rate (unemployment) by year and
month.

After merging the three datasets, we can easily track unemployment rates
and economic changes in relation to political changes.

# Problem 2

## Setting up datasets

``` r
MrTrashWheel_df <- 
  read_excel("202509 Trash Wheel Collection Data.xlsx", sheet = "Mr. Trash Wheel" , na = c("NA", ".", " ")) |> 
  janitor::clean_names() |> 
  filter( dumpster != "na") |> 
  select(-15,-16) |> 
  mutate(sports_balls = as.integer(round(sports_balls))) |> 
  mutate(track = "Mr.Trash Wheel") |> 
  mutate(year = as.numeric(year))
```

    ## New names:
    ## • `` -> `...15`
    ## • `` -> `...16`

``` r
ProfTrashWheel_df <- 
  read_excel("202409 Trash Wheel Collection Data.xlsx", sheet = "Professor Trash Wheel", na = c("NA", ".", " ")) |> 
  janitor::clean_names() |> 
  filter( dumpster != "na") |> 
  mutate(track = "Professor Trash Wheel")


GwynndaTrashWheel_df <- 
  read_excel("202409 Trash Wheel Collection Data.xlsx", sheet = "Gwynnda Trash Wheel", na = c("NA", ".", " ")) |> 
janitor::clean_names()|> 
  filter( dumpster != "na") |> 
  mutate(track = "Gwynnda Trash Wheel")
```

## Combines datasets

``` r
AllTrashWheel_df <- 
  bind_rows(MrTrashWheel_df,ProfTrashWheel_df,GwynndaTrashWheel_df)

knitr::kable(head(AllTrashWheel_df,10), caption = "First 10 rows")
```

| dumpster | month | year | date | weight_tons | volume_cubic_yards | plastic_bottles | polystyrene | cigarette_butts | glass_bottles | plastic_bags | wrappers | sports_balls | homes_powered | track |
|---:|:---|---:|:---|---:|---:|---:|---:|---:|---:|---:|---:|---:|---:|:---|
| 1 | May | 2014 | 2014-05-16 | 4.31 | 18 | 1450 | 1820 | 126000 | 72 | 584 | 1162 | 7 | 0 | Mr.Trash Wheel |
| 2 | May | 2014 | 2014-05-16 | 2.74 | 13 | 1120 | 1030 | 91000 | 42 | 496 | 874 | 5 | 0 | Mr.Trash Wheel |
| 3 | May | 2014 | 2014-05-16 | 3.45 | 15 | 2450 | 3100 | 105000 | 50 | 1080 | 2032 | 6 | 0 | Mr.Trash Wheel |
| 4 | May | 2014 | 2014-05-17 | 3.10 | 15 | 2380 | 2730 | 100000 | 52 | 896 | 1971 | 6 | 0 | Mr.Trash Wheel |
| 5 | May | 2014 | 2014-05-17 | 4.06 | 18 | 980 | 870 | 120000 | 72 | 368 | 753 | 7 | 0 | Mr.Trash Wheel |
| 6 | May | 2014 | 2014-05-20 | 2.71 | 13 | 1430 | 2140 | 90000 | 46 | 672 | 1144 | 5 | 0 | Mr.Trash Wheel |
| 7 | May | 2014 | 2014-05-21 | 1.91 | 8 | 910 | 1090 | 56000 | 32 | 416 | 692 | 3 | 0 | Mr.Trash Wheel |
| 8 | May | 2014 | 2014-05-28 | 3.70 | 16 | 3580 | 4310 | 112000 | 58 | 1552 | 3015 | 6 | 0 | Mr.Trash Wheel |
| 9 | June | 2014 | 2014-06-05 | 2.52 | 14 | 2400 | 2790 | 98000 | 49 | 984 | 1988 | 6 | 0 | Mr.Trash Wheel |
| 10 | June | 2014 | 2014-06-11 | 3.76 | 18 | 1340 | 1730 | 130000 | 75 | 448 | 1066 | 7 | 0 | Mr.Trash Wheel |

First 10 rows

# Writing question for Problem 2:

The total weight of the Professor Trash Wheel is 246.74 during those
days. And And the total number of cigarette butts collected by Gwynnda
in June of 2022 is 18,120.

# Problem 3

## Clean data

``` r
Zip_Codes_df <- 
  read_csv("zillow_data/Zip Codes.csv", na = c("NA", ".", " ")) |> 
  janitor::clean_names() |> 
  arrange(zip_code)
```

    ## Rows: 322 Columns: 7
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (4): County, County Code, File Date, Neighborhood
    ## dbl (3): State FIPS, County FIPS, ZipCode
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
Zillow_df <- 
  read_csv("zillow_data/Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv", na = c("NA", ".", " ")) |> 
  janitor::clean_names() |> 
  pivot_longer(
    cols = x2015_01_31 : x2024_08_31,
    names_to = "Date",
    values_to = "rental_fee"
  ) |> 
  separate(Date, into = c("year", "month" , "day"), sep = "_") |> 
  mutate(year = sub("x","",year)) |> 
  filter(rental_fee != "na") |> 
  arrange(desc(rental_fee)) |> 
  rename( zip_code = region_name) |> 
  filter(zip_code != "na" )
```

    ## Rows: 149 Columns: 125
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr   (6): RegionType, StateName, State, City, Metro, CountyName
    ## dbl (119): RegionID, SizeRank, RegionName, 2015-01-31, 2015-02-28, 2015-03-3...
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

## Create single

``` r
Zillow_Zipcode_df <-  
  left_join(Zip_Codes_df, Zillow_df, by = "zip_code",relationship = "many-to-many") |> 
  select(-county_fips, -state_fips,-county_code,-file_date, -region_id, -size_rank, -region_type, -metro, -state_name)

knitr::kable(head(Zillow_Zipcode_df,10), caption = "First 10 rows")
```

| county | zip_code | neighborhood | state | city | county_name | year | month | day | rental_fee |
|:---|---:|:---|:---|:---|:---|:---|:---|:---|---:|
| New York | 10001 | Chelsea and Clinton | NY | New York | New York County | 2024 | 07 | 31 | 5176.020 |
| New York | 10001 | Chelsea and Clinton | NY | New York | New York County | 2024 | 08 | 31 | 5174.641 |
| New York | 10001 | Chelsea and Clinton | NY | New York | New York County | 2024 | 06 | 30 | 5148.429 |
| New York | 10001 | Chelsea and Clinton | NY | New York | New York County | 2023 | 08 | 31 | 5112.285 |
| New York | 10001 | Chelsea and Clinton | NY | New York | New York County | 2023 | 09 | 30 | 5096.981 |
| New York | 10001 | Chelsea and Clinton | NY | New York | New York County | 2024 | 05 | 31 | 5076.398 |
| New York | 10001 | Chelsea and Clinton | NY | New York | New York County | 2023 | 07 | 31 | 5052.620 |
| New York | 10001 | Chelsea and Clinton | NY | New York | New York County | 2023 | 10 | 31 | 5023.070 |
| New York | 10001 | Chelsea and Clinton | NY | New York | New York County | 2022 | 08 | 31 | 5020.921 |
| New York | 10001 | Chelsea and Clinton | NY | New York | New York County | 2022 | 09 | 30 | 5013.240 |

First 10 rows

## Writing question for Problem 3:

``` r
distinct_all <- Zillow_Zipcode_df %>% distinct(zip_code)
distinct_Zillow <- Zillow_df %>% distinct(zip_code)

Exclude_Zillow <- setdiff(Zip_Codes_df$zip_code, Zillow_df$zip_code)
```

``` r
price_diff <- Zillow_Zipcode_df |> 
  select(year,month, zip_code, neighborhood, rental_fee, county_name) |> 
  filter(year == '2020' & month == "01" | year == '2021' & month == "01") |> 
  mutate(rental_2020 = case_when(year == '2020' ~ rental_fee), rental_2021 = case_when(year == "2021" ~ rental_fee)) |> 
   pivot_wider(
    id_cols   = c(zip_code, neighborhood, county_name),   
    names_from  = year,                                  
    values_from = rental_fee,                           
    names_prefix = "rental_",                             
    values_fn  = list(rental_fee = ~ first(na.omit(.))),  
    values_fill = NA_real_                                
  ) |> 
    mutate(diff = rental_2020 - rental_2021) |> 
  arrange(desc(diff))

top10 <- price_diff |> 
  slice_max(order_by = diff, n = 10) |> 
  rename(
    borough = county_name,
    zip = zip_code,
    neighborhood = neighborhood,
    rent_2020 = rental_2020,
    rent_2021 = rental_2021,
    drop = diff
  )
```

There are total **10848 obs, 320** unique zip codes and **43** unique
neighborhoods. ZIP codes appear in the ZIP code dataset but not in the
Zillow Rental Price dataset are: 10008 10020 10041 10043 10045 10047
10048 10055 10072 10080 10081 10082 10087 10101 10102 10103 10104 10105
10106 10107 10108 10109 10110 10111 10112 10113 10114 10115 10116 10117
10118 10119 10120 10121 10122 10123 10124 10125 10126 10129 10130 10131
10132 10133 10138 10149 10150 10151 10152 10153 10154 10155 10156 10157
10158 10159 10160 10161 10163 10164 10165 10166 10167 10168 10169 10170
10171 10172 10173 10174 10175 10176 10177 10178 10179 10185 10197 10199
10213 10242 10249 10256 10259 10260 10261 10265 10268 10269 10270 10271
10272 10273 10274 10275 10276 10277 10278 10279 10281 10285 10286 10292
10302 10307 10309 10310 10311 10313 10464 10474 10475 10499 10550 10704
10705 10803 11001 11004 11005 11040 11096 11202 11224 11239 11241 11242
11243 11245 11247 11251 11252 11256 11351 11352 11359 11362 11363 11371
11380 11381 11386 11405 11411 11412 11413 11414 11416 11417 11419 11420
11421 11422 11423 11424 11425 11427 11428 11429 11430 11431 11433 11436
11439 11451 11499 11559 11580 11690 11694 11695 11697.

**Some Example should be consider to this results can be:**

**1.** Some of the Zip-code area such as 10020 in NYC are mostly
Commercial place.

**2.** Some Zip-code are not for the residential area, For example
10101 - 10199 are mostly using for P.O. Boxes or other institution.

**3.** Some Zip-Code area are very small.

**4.** The data from Zillow is basicly rely on the house for sale or
rent.

**The table includes the ten zip codes with largest drop in price is:**

| zip | neighborhood | borough | rent_2020 | rent_2021 | drop |
|---:|:---|:---|---:|---:|---:|
| 10007 | Lower Manhattan | New York County | 6334.21 | 5421.61 | 912.60 |
| 10069 | NA | New York County | 4623.04 | 3874.92 | 748.12 |
| 10009 | Lower East Side | New York County | 3406.44 | 2692.19 | 714.25 |
| 10016 | Gramercy Park and Murray Hill | New York County | 3731.14 | 3019.43 | 711.70 |
| 10001 | Chelsea and Clinton | New York County | 4108.10 | 3397.65 | 710.45 |
| 10002 | Lower East Side | New York County | 3645.42 | 2935.11 | 710.30 |
| 10004 | Lower Manhattan | New York County | 3149.66 | 2443.70 | 705.96 |
| 10038 | Lower Manhattan | New York County | 3573.20 | 2875.62 | 697.59 |
| 10012 | Greenwich Village and Soho | New York County | 3628.57 | 2942.34 | 686.22 |
| 10010 | Gramercy Park and Murray Hill | New York County | 3697.28 | 3012.35 | 684.93 |

.
